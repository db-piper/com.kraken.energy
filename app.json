{
  "_comment": "This file is generated. Please edit .homeycompose/app.json instead.",
  "id": "com.kraken.energy",
  "version": "1.1.0",
  "compatibility": ">=12.4.0",
  "sdk": 3,
  "brandColor": "#5940ff",
  "homeyCommunityTopicId": 136685,
  "source": "https://github.com/db-piper/com.kraken.energy",
  "bugs": {
    "url": "https://github.com/db-piper/com.kraken.energy/issues"
  },
  "platforms": [
    "local"
  ],
  "name": {
    "en": "Kraken Energy"
  },
  "description": {
    "en": "Monitor the live use of energy using an Octopus Home Mini"
  },
  "category": "energy",
  "tags": {
    "en": [
      "kraken",
      "octopus",
      "energy",
      "live",
      "home mini"
    ]
  },
  "insights": [
    {
      "id": "memory_rss",
      "title": {
        "en": "App Memory Usage"
      },
      "type": "number",
      "units": "KB",
      "decimals": 1,
      "chartType": "line"
    }
  ],
  "permissions": [],
  "images": {
    "small": "/assets/images/kraken_energy_monitoring_small.png",
    "large": "/assets/images/kraken_energy_monitoring_medium.png",
    "xlarge": "/assets/images/kraken_energy_monitoring_large.png"
  },
  "author": {
    "name": "David Piper",
    "email": "david.piper@normandygite.org.uk"
  },
  "contributors": {
    "developers": [
      {
        "name": "David Piper"
      }
    ]
  },
  "homepage": "https://github.com/db-piper/com.kraken.energy/wiki",
  "flow": {
    "triggers": [
      {
        "id": "data_presence.next_day_prices_true",
        "title": {
          "en": "Next Day Prices Published"
        },
        "hint": {
          "en": "Triggers when tariff prices for the next day are published."
        },
        "args": [
          {
            "type": "device",
            "name": "device",
            "filter": "driver_id=krakendevicedriver&capabilities=data_presence.next_day_prices"
          }
        ]
      },
      {
        "id": "data_presence.next_day_prices_false",
        "title": {
          "en": "Next Day Prices Unpublished"
        },
        "hint": {
          "en": "Triggers when tariff prices for the next day become unavailable, normally as midnight passes."
        },
        "args": [
          {
            "type": "device",
            "name": "device",
            "filter": "driver_id=krakendevicedriver&capabilities=data_presence.next_day_prices"
          }
        ]
      },
      {
        "id": "slot_quartile_changed",
        "title": {
          "en": "Pricing quartile changed"
        },
        "hint": {
          "en": "The pricing quartile has changed."
        },
        "tokens": [
          {
            "name": "slot_quartile",
            "type": "number",
            "title": {
              "en": "Price Quartile Number"
            },
            "example": {
              "en": "From 0 (lowest prices) to 3 (highest prices)"
            }
          }
        ],
        "args": [
          {
            "type": "device",
            "name": "device",
            "filter": "driver_id=krakendevicedriver&capabilities=slot_quartile"
          }
        ]
      },
      {
        "id": "percent.dispatch_limit_changed",
        "title": {
          "en": "Dispatch Limit Usage Changed"
        },
        "hint": {
          "en": "The number of minutes consumed towards the dispatch limit has changed."
        },
        "tokens": [
          {
            "name": "percent.dispatch_limit",
            "type": "number",
            "title": {
              "en": "Dispatch Limit Percent Usage"
            },
            "example": {
              "en": "From 0 (no usage) to 100 (limit reached). Limit can be exceeded"
            }
          }
        ],
        "args": [
          {
            "type": "device",
            "name": "device",
            "filter": "driver_id=krakendevicedriver&capabilities=percent.dispatch_limit"
          }
        ]
      },
      {
        "id": "date_time.period_start_changed",
        "title": {
          "en": "New Invoicing Period Started"
        },
        "hint": {
          "en": "A new invoicing period has started and an invoice will be issued shortly."
        },
        "tokens": [
          {
            "name": "date_time.period_start",
            "type": "string",
            "title": {
              "en": "Invoice Period Start Date"
            },
            "example": {
              "en": "2026-01-21. When the old period ends or the Period Start Day setting is modified."
            }
          }
        ],
        "args": [
          {
            "type": "device",
            "name": "device",
            "filter": "driver_id=krakendevicedriver&capabilities=date_time.period_start"
          }
        ]
      },
      {
        "id": "period_day.period_day_changed",
        "title": {
          "en": "Invoice Period Day Has Changed"
        },
        "hint": {
          "en": "The day nummber in the current invoicing period has changed."
        },
        "tokens": [
          {
            "name": "period_day.period_day",
            "type": "number",
            "title": {
              "en": "Invoice Period Day Number"
            },
            "example": {
              "en": "From 1 to 28-31 depending on the month."
            }
          }
        ],
        "args": [
          {
            "type": "device",
            "name": "device",
            "filter": "driver_id=krakendevicedriver&capabilities=period_day.period_day"
          }
        ]
      },
      {
        "id": "item_count.dispatch_minutes_changed",
        "title": {
          "en": "Device Dispatch Minutes Count Has Changed"
        },
        "hint": {
          "en": "The number of dispatch minutes to the device has changed."
        },
        "tokens": [
          {
            "name": "item_count.dispatch_minutes",
            "type": "number",
            "title": {
              "en": "Dispatch Minutes Count"
            },
            "example": {
              "en": "From 0 to 1440 minutes."
            }
          }
        ],
        "args": [
          {
            "type": "device",
            "name": "device",
            "filter": "driver_id=krakendevicedriver&capabilities=item_count.dispatch_minutes"
          }
        ]
      },
      {
        "id": "date_time.slot_end_changed",
        "title": {
          "en": "Tariff Price Slot Changed"
        },
        "hint": {
          "en": "A new tariff slot has started with a different energy unit price."
        },
        "args": [
          {
            "type": "device",
            "name": "device",
            "filter": "driver_id=krakendevicedriver&capabilities=date_time.slot_end"
          }
        ]
      },
      {
        "id": "data_presence.in_dispatch_true",
        "title": {
          "en": "Planned Dispatch Starts"
        },
        "hint": {
          "en": "Triggers when a Planned Dispatch to the Smart Energy Device starts."
        },
        "args": [
          {
            "type": "device",
            "name": "device",
            "filter": "driver_id=krakendevicedriver&capabilities=data_presence.in_dispatch"
          }
        ]
      },
      {
        "id": "data_presence.in_dispatch_false",
        "title": {
          "en": "Planned Dispatch Ends"
        },
        "hint": {
          "en": "Triggers when a Planned Dispatch to the Smart Energy Device ends."
        },
        "args": [
          {
            "type": "device",
            "name": "device",
            "filter": "driver_id=krakendevicedriver&capabilities=data_presence.in_dispatch"
          }
        ]
      },
      {
        "id": "data_presence.dispatch_pricing_true",
        "title": {
          "en": "Dispatch Pricing Starts"
        },
        "hint": {
          "en": "Triggers when an extended dispatch period to any Smart Energy Device starts."
        },
        "args": [
          {
            "type": "device",
            "name": "device",
            "filter": "driver_id=krakendevicedriver&capabilities=data_presence.dispatch_pricing"
          }
        ]
      },
      {
        "id": "data_presence.dispatch_pricing_false",
        "title": {
          "en": "Dispatch Pricing Ends"
        },
        "hint": {
          "en": "Triggers when an extended dispatch period to any Smart Energy Device ends."
        },
        "args": [
          {
            "type": "device",
            "name": "device",
            "filter": "driver_id=krakendevicedriver&capabilities=data_presence.dispatch_pricing"
          }
        ]
      }
    ],
    "conditions": [
      {
        "id": "slot_relative_price",
        "title": {
          "en": "Current kWh Price Is !{{Cheaper|More Expensive}} Than The Next Slot"
        },
        "hint": {
          "en": "Compares the price per kWH of the current slot with that for the next slot. Card can be inverted."
        },
        "args": [
          {
            "type": "device",
            "name": "device",
            "filter": "driver_id=krakendevicedriver&capabilities=slot_quartile"
          }
        ]
      }
    ]
  },
  "drivers": [
    {
      "name": {
        "en": "Kraken Devices"
      },
      "class": "sensor",
      "capabilities": [],
      "platforms": [
        "local"
      ],
      "connectivity": [],
      "images": {
        "small": "/drivers/krakendevicedriver/assets/images/octopus-home-mini-small.png",
        "large": "/drivers/krakendevicedriver/assets/images/octopus-home-mini-medium.png",
        "xlarge": "/drivers/krakendevicedriver/assets/images/octopus-home-mini-large.png"
      },
      "pair": [
        {
          "id": "login_credentials",
          "template": "login_credentials",
          "options": {
            "logo": "assets/images/octopus-home-mini-small.png",
            "title": {
              "en": "Energy Account Details"
            },
            "usernameLabel": {
              "en": "Account Number"
            },
            "usernamePlaceholder": {
              "en": "A-9A999999"
            },
            "passwordLabel": {
              "en": "Account API Key"
            },
            "passwordPlaceholder": {
              "en": "sk_live_... 32 characters"
            }
          }
        },
        {
          "id": "list_devices",
          "template": "list_devices",
          "navigation": {
            "next": "add_devices"
          }
        },
        {
          "id": "add_devices",
          "template": "add_devices"
        }
      ],
      "repair": [
        {
          "id": "login_credentials",
          "template": "login_credentials",
          "options": {
            "logo": "assets/images/octopus-home-mini-small.png",
            "title": {
              "en": "Energy Account Details"
            },
            "usernameLabel": {
              "en": "Account Number"
            },
            "usernamePlaceholder": {
              "en": "A-9A999999"
            },
            "passwordLabel": {
              "en": "Account API Key"
            },
            "passwordPlaceholder": {
              "en": "sk_live_... 32 characters"
            }
          }
        }
      ],
      "id": "krakendevicedriver",
      "settings": [
        {
          "id": "periodStartDay",
          "type": "number",
          "label": {
            "en": "Invoice Period Start Day (1-31)"
          },
          "value": 0,
          "min": 1,
          "max": 31,
          "step": 1,
          "units": {
            "en": "Day"
          }
        },
        {
          "id": "dispatchMinutesLimit",
          "type": "number",
          "label": {
            "en": "Dispatch Minutes Limit"
          },
          "value": 360,
          "min": 0,
          "max": 1440,
          "step": 15,
          "units": {
            "en": "Minutes"
          }
        },
        {
          "id": "krakenPollingInterval",
          "type": "dropdown",
          "value": "1",
          "label": {
            "en": "Kraken Polling Interval"
          },
          "values": [
            {
              "id": "1",
              "label": {
                "en": "1 minute"
              }
            },
            {
              "id": "2",
              "label": {
                "en": "2 minutes"
              }
            },
            {
              "id": "3",
              "label": {
                "en": "3 minutes"
              }
            },
            {
              "id": "5",
              "label": {
                "en": "5 minutes"
              }
            }
          ]
        }
      ]
    }
  ],
  "capabilities": {
    "data_presence": {
      "type": "boolean",
      "title": {
        "en": "Data Presence"
      },
      "getable": true,
      "setable": false,
      "icon": "/assets/presence.svg",
      "insights": false,
      "titleTrue": {
        "en": "present"
      },
      "titleFalse": {
        "en": "absent"
      }
    },
    "date_time": {
      "type": "string",
      "title": {
        "en": "Date Time"
      },
      "getable": true,
      "setable": false,
      "icon": "/assets/event.svg",
      "insights": false
    },
    "device_attribute": {
      "type": "string",
      "title": {
        "en": "Device"
      },
      "getable": true,
      "setable": false,
      "icon": "/assets/devices.svg",
      "insights": false
    },
    "duration": {
      "type": "string",
      "title": {
        "en": "Duration"
      },
      "getable": true,
      "setable": false,
      "icon": "/assets/timer.svg",
      "insights": false,
      "uiComponent": "sensor",
      "decimals": 0
    },
    "item_count": {
      "type": "number",
      "title": {
        "en": "Item Count"
      },
      "getable": true,
      "setable": false,
      "icon": "/assets/devices.svg",
      "insights": false,
      "uiComponent": "sensor",
      "decimals": 0
    },
    "month_day": {
      "type": "enum",
      "title": {
        "en": "Month Day"
      },
      "getable": true,
      "setable": true,
      "icon": "/assets/monthday.svg",
      "insights": false,
      "uiComponent": "picker",
      "values": [
        {
          "id": "01",
          "title": "01"
        },
        {
          "id": "02",
          "title": "02"
        },
        {
          "id": "03",
          "title": "03"
        },
        {
          "id": "04",
          "title": "04"
        },
        {
          "id": "05",
          "title": "05"
        },
        {
          "id": "06",
          "title": "06"
        },
        {
          "id": "07",
          "title": "07"
        },
        {
          "id": "08",
          "title": "08"
        },
        {
          "id": "09",
          "title": "09"
        },
        {
          "id": "10",
          "title": "10"
        },
        {
          "id": "11",
          "title": "11"
        },
        {
          "id": "12",
          "title": "12"
        },
        {
          "id": "13",
          "title": "13"
        },
        {
          "id": "14",
          "title": "14"
        },
        {
          "id": "15",
          "title": "15"
        },
        {
          "id": "16",
          "title": "16"
        },
        {
          "id": "17",
          "title": "17"
        },
        {
          "id": "18",
          "title": "18"
        },
        {
          "id": "19",
          "title": "19"
        },
        {
          "id": "20",
          "title": "20"
        },
        {
          "id": "21",
          "title": "21"
        },
        {
          "id": "22",
          "title": "22"
        },
        {
          "id": "23",
          "title": "23"
        },
        {
          "id": "24",
          "title": "24"
        },
        {
          "id": "25",
          "title": "25"
        },
        {
          "id": "26",
          "title": "26"
        },
        {
          "id": "27",
          "title": "27"
        },
        {
          "id": "28",
          "title": "28"
        },
        {
          "id": "29",
          "title": "29"
        },
        {
          "id": "30",
          "title": "30"
        },
        {
          "id": "31",
          "title": "31"
        }
      ]
    },
    "percent": {
      "type": "number",
      "title": {
        "en": "Percent"
      },
      "getable": true,
      "setable": false,
      "icon": "/assets/tax.svg",
      "insights": true,
      "uiComponent": "sensor",
      "decimals": 1,
      "units": {
        "en": "%"
      }
    },
    "period_day": {
      "type": "number",
      "title": {
        "en": "Period Day"
      },
      "getable": true,
      "setable": false,
      "icon": "/assets/monthday.svg",
      "insights": false,
      "uiComponent": "sensor",
      "min": 1,
      "max": 31,
      "step": 1,
      "decimals": 0
    },
    "product_code": {
      "type": "string",
      "title": {
        "en": "Product Code"
      },
      "getable": true,
      "setable": false,
      "icon": "/assets/product.svg",
      "insights": false
    },
    "slot_quartile": {
      "type": "number",
      "title": {
        "en": "Slot Price Quartile"
      },
      "getable": true,
      "setable": false,
      "icon": "/assets/quartile.svg",
      "insights": true,
      "uiComponent": "sensor",
      "decimals": 0,
      "min": 0,
      "max": 3,
      "step": 1
    },
    "tariff_code": {
      "type": "string",
      "title": {
        "en": "Tariff Code"
      },
      "getable": true,
      "setable": false,
      "icon": "/assets/tariff.svg",
      "insights": false
    }
  }
}